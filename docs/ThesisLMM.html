<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ThesisLMM</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="ThesisLMM_files/libs/clipboard/clipboard.min.js"></script>
<script src="ThesisLMM_files/libs/quarto-html/quarto.js"></script>
<script src="ThesisLMM_files/libs/quarto-html/popper.min.js"></script>
<script src="ThesisLMM_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ThesisLMM_files/libs/quarto-html/anchor.min.js"></script>
<link href="ThesisLMM_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ThesisLMM_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ThesisLMM_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ThesisLMM_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ThesisLMM_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ThesisLMM</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>allthesis <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"C:/Users/barne/Downloads/ThesisRData.xlsx"</span>, <span class="at">sheet =</span> <span class="dv">1</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>allthesis <span class="ot">&lt;-</span> allthesis <span class="sc">|&gt;</span> </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TSS =</span> <span class="fu">as.numeric</span>(TSS))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>avgthesis <span class="ot">&lt;-</span> allthesis <span class="sc">|&gt;</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Site, Lake) <span class="sc">|&gt;</span>  <span class="co"># Include Lake as a grouping variable</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="basic-lm-models" class="level1">
<h1>Basic LM Models</h1>
<p>First we want to plot the regressions between light attenuation and each of our predictors while also displaying the slope equation, R2, Pvalue, and standard error</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to get regression statistics (equation, R2, p-value, SE)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>get_regression_stats <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  eq <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"y = "</span>, <span class="fu">round</span>(<span class="fu">coef</span>(model)[<span class="dv">2</span>], <span class="dv">2</span>), <span class="st">"x + "</span>, <span class="fu">round</span>(<span class="fu">coef</span>(model)[<span class="dv">1</span>], <span class="dv">2</span>), <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  rsq <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"RÂ² = "</span>, <span class="fu">round</span>(<span class="fu">summary</span>(model)<span class="sc">$</span>r.squared, <span class="dv">3</span>), <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"p = "</span>, <span class="fu">round</span>(<span class="fu">summary</span>(model)<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">4</span>], <span class="dv">3</span>), <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  se <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"SE = "</span>, <span class="fu">round</span>(<span class="fu">summary</span>(model)<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">3</span>), <span class="at">sep =</span> <span class="st">""</span>)  <span class="co"># Extract SE</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">eq =</span> eq, <span class="at">rsq =</span> rsq, <span class="at">pval =</span> pval, <span class="at">se =</span> se))</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>reg_stats_p1 <span class="ot">&lt;-</span> <span class="fu">get_regression_stats</span>(avgthesis<span class="sc">$</span>TSS, avgthesis<span class="sc">$</span>kd)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>reg_stats_p2 <span class="ot">&lt;-</span> <span class="fu">get_regression_stats</span>(avgthesis<span class="sc">$</span>CHLa, avgthesis<span class="sc">$</span>kd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># TSS vs kd</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(avgthesis, <span class="fu">aes</span>(<span class="at">x =</span> TSS, <span class="at">y =</span> kd)) <span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"gray70"</span>) <span class="sc">+</span>  </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span>  </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"kd vs TSS"</span>, <span class="at">x =</span> <span class="st">"TSS (mg Lâ»Â¹)"</span>, <span class="at">y =</span> <span class="st">"kd (mâ»Â¹)"</span>) <span class="sc">+</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">x =</span> <span class="fu">max</span>(avgthesis<span class="sc">$</span>TSS), <span class="at">y =</span> <span class="fu">max</span>(avgthesis<span class="sc">$</span>kd), </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="fu">paste</span>(reg_stats_p1<span class="sc">$</span>eq, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, reg_stats_p1<span class="sc">$</span>rsq, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, reg_stats_p1<span class="sc">$</span>pval, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, reg_stats_p1<span class="sc">$</span>se), </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> <span class="st">"black"</span>),  </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>, <span class="at">color =</span> <span class="st">"black"</span>), </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>, <span class="at">color =</span> <span class="st">"black"</span>))</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co"># CHLa vs kd</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(avgthesis, <span class="fu">aes</span>(<span class="at">x =</span> CHLa, <span class="at">y =</span> kd)) <span class="sc">+</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"gray70"</span>) <span class="sc">+</span>  </span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span>  </span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"kd vs CHLa"</span>, <span class="at">x =</span> <span class="st">"CHLa (ug Lâ»Â¹)"</span>, <span class="at">y =</span> <span class="st">"kd (mâ»Â¹)"</span>) <span class="sc">+</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">x =</span> <span class="fu">max</span>(avgthesis<span class="sc">$</span>CHLa), <span class="at">y =</span> <span class="fu">max</span>(avgthesis<span class="sc">$</span>kd), </span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="fu">paste</span>(reg_stats_p2<span class="sc">$</span>eq, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, reg_stats_p2<span class="sc">$</span>rsq, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, reg_stats_p2<span class="sc">$</span>pval, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, reg_stats_p2<span class="sc">$</span>se), </span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> <span class="st">"black"</span>),  </span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>, <span class="at">color =</span> <span class="st">"black"</span>), </span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>, <span class="at">color =</span> <span class="st">"black"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To look at the relationship between kd and CDOM, we first need to find the residual kd. We do this by finding the proportion of kd due to TSS, then subtracting that out of our original kd values for each site.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate residual kd</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>avgthesis <span class="ot">&lt;-</span> avgthesis <span class="sc">|&gt;</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Residualkd =</span> kd <span class="sc">-</span> (TSS<span class="sc">*</span><span class="fl">0.20337</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>reg_stats_p3 <span class="ot">&lt;-</span> <span class="fu">get_regression_stats</span>(avgthesis<span class="sc">$</span>CDOM, avgthesis<span class="sc">$</span>Residualkd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can perform a regression between CDOM and residual kd then arrange our plots into one output</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CDOM vs Residual kd</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(avgthesis, <span class="fu">aes</span>(<span class="at">x =</span> CDOM, <span class="at">y =</span> Residualkd)) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"gray70"</span>) <span class="sc">+</span>  </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span>  </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Residual kd vs CDOM"</span>, <span class="at">x =</span> <span class="st">"CDOM (mâ»Â¹)"</span>, <span class="at">y =</span> <span class="st">"Residualkd (mâ»Â¹)"</span>) <span class="sc">+</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">x =</span> <span class="fu">max</span>(avgthesis<span class="sc">$</span>CDOM), <span class="at">y =</span> <span class="fu">max</span>(avgthesis<span class="sc">$</span>Residualkd), </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="fu">paste</span>(reg_stats_p3<span class="sc">$</span>eq, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, reg_stats_p3<span class="sc">$</span>rsq, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, reg_stats_p3<span class="sc">$</span>pval, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, reg_stats_p3<span class="sc">$</span>se), </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> <span class="st">"black"</span>),  </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>, <span class="at">color =</span> <span class="st">"black"</span>), </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>, <span class="at">color =</span> <span class="st">"black"</span>))</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot all regressions in the same output</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, p3, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ThesisLMM_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>To examine these relationships further, we can look at the summaries of each regression</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>p1summary <span class="ot">&lt;-</span> <span class="fu">lm</span>(kd <span class="sc">~</span> TSS, <span class="at">data =</span> allthesis)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(p1summary)</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>p2summary <span class="ot">&lt;-</span> <span class="fu">lm</span>(kd <span class="sc">~</span> CHLa, <span class="at">data =</span> avgthesis)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(p2summary)</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>p3summary <span class="ot">&lt;-</span> <span class="fu">lm</span>(Residualkd <span class="sc">~</span> CDOM, <span class="at">data =</span> avgthesis)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(p3summary)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can also look at the diagnostic plots for each of the models, we do this by creating a function and calling that function with each model we want to examine</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to create diagnostic plots for each model</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>create_diagnostic_plots <span class="ot">&lt;-</span> <span class="cf">function</span>(model) {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Residuals vs Fitted plot</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(model, <span class="at">which =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"Residuals vs Fitted"</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Normal Q-Q plot</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(model, <span class="at">which =</span> <span class="dv">2</span>, <span class="at">main =</span> <span class="st">"Normal Q-Q"</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Scale-Location plot</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(model, <span class="at">which =</span> <span class="dv">3</span>, <span class="at">main =</span> <span class="st">"Scale-Location"</span>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Residuals vs Leverage plot</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(model, <span class="at">which =</span> <span class="dv">5</span>, <span class="at">main =</span> <span class="st">"Residuals vs Leverage"</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co">#create_diagnostic_plots(p1summary)</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co">#create_diagnostic_plots(p2summary)</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="co">#create_diagnostic_plots(p3summary)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to examine how much light attenuation at each site can be attributed to the effects of TSS and CDOM (our two significant predictors). To do this, we multiply average predictor values for each site by the slope of the predictor relationship, then divide this by the original kd. Finally, we multiply by 100 to convert this proportion to a percentage.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>PercentContributions <span class="ot">&lt;-</span> avgthesis <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">%TSS</span><span class="st">`</span> <span class="ot">=</span> ((TSS<span class="sc">*</span><span class="fl">0.20337</span>)<span class="sc">/</span>kd)<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">%CDOM</span><span class="st">`</span> <span class="ot">=</span> ((CDOM<span class="sc">*</span><span class="fl">0.17382</span>)<span class="sc">/</span>kd)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="st">`</span><span class="at">Site</span><span class="st">`</span>, <span class="st">`</span><span class="at">%TSS</span><span class="st">`</span>, <span class="st">`</span><span class="at">%CDOM</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot the data into long format for ggplot</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>PercentContributions_long <span class="ot">&lt;-</span> PercentContributions <span class="sc">|&gt;</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">%TSS</span><span class="st">`</span>, <span class="st">`</span><span class="at">%CDOM</span><span class="st">`</span>), </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Variable"</span>, </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"PercentContribution"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Manually recoding the 'Site' variable</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>PercentContributions_long <span class="ot">&lt;-</span> PercentContributions_long <span class="sc">|&gt;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Site =</span> dplyr<span class="sc">::</span><span class="fu">recode</span>(Site, </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"2-BRI010.78"</span> <span class="ot">=</span> <span class="st">"BRI_1"</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"2-BRI013.12"</span> <span class="ot">=</span> <span class="st">"BRI_2"</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"5ANTW127.14"</span> <span class="ot">=</span> <span class="st">"Barfoot"</span>,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Chickahominy"</span> <span class="ot">=</span> <span class="st">"Chick"</span>,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Harrison"</span> <span class="ot">=</span> <span class="st">"Harrison"</span>,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"2-SDY004.27"</span> <span class="ot">=</span> <span class="st">"SDY_1"</span>,</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"2-SDY005.85"</span> <span class="ot">=</span> <span class="st">"SDY_2"</span>,</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"2-MBN000.96"</span> <span class="ot">=</span> <span class="st">"SDY_3"</span>,</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"2-SFT031.08"</span> <span class="ot">=</span> <span class="st">"SFT_1"</span>,</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"2-DYC000.19"</span> <span class="ot">=</span> <span class="st">"SFT_2"</span>,</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"2-SFT033.42"</span> <span class="ot">=</span> <span class="st">"SFT_3"</span>,</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"2-SFT034.38"</span> <span class="ot">=</span> <span class="st">"SFT_4"</span>,</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Dam Surface"</span> <span class="ot">=</span> <span class="st">"ANNA"</span>))</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Change the site order for plot visualization</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>site_order <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">"Harrison"</span>, <span class="st">"Chick"</span>, <span class="st">"BRI_1"</span>, <span class="st">"BRI_2"</span>, <span class="st">"SDY_1"</span>, <span class="st">"SDY_2"</span>, <span class="st">"SDY_3"</span>, <span class="st">"SFT_1"</span>, <span class="st">"SFT_2"</span>, <span class="st">"SFT_3"</span>, <span class="st">"SFT_4"</span>, <span class="st">"Barfoot"</span>, <span class="st">"ANNA"</span>)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>PercentContributions_long <span class="ot">&lt;-</span> PercentContributions_long <span class="sc">|&gt;</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Site =</span> <span class="fu">factor</span>(Site, <span class="at">levels =</span> site_order))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(PercentContributions_long, <span class="fu">aes</span>(<span class="at">x =</span> Site, <span class="at">y =</span> PercentContribution, <span class="at">fill =</span> Variable)) <span class="sc">+</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"stack"</span>) <span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"% kd Contributions of TSS and CDOM by Site"</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Site"</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"% kd"</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Variable"</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ThesisLMM_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="multivariate-linear-regression" class="level1">
<h1>Multivariate Linear Regression</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> <span class="st">"kd"</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"TSS"</span>, <span class="st">"CDOM"</span>, <span class="st">"CHLa"</span>)  </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate all combinations of predictors</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>all_combinations <span class="ot">&lt;-</span> <span class="fu">unlist</span>(</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="dv">0</span><span class="sc">:</span><span class="fu">length</span>(predictors), <span class="cf">function</span>(x) <span class="fu">combn</span>(predictors, x, <span class="at">simplify =</span> <span class="cn">FALSE</span>)), </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">recursive =</span> <span class="cn">FALSE</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>model_results <span class="ot">&lt;-</span> <span class="fu">lapply</span>(all_combinations, <span class="cf">function</span>(predictor_set) {</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(response, <span class="st">"~"</span>, <span class="fu">ifelse</span>(<span class="fu">length</span>(predictor_set) <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"1"</span>, <span class="fu">paste</span>(predictor_set, <span class="at">collapse =</span> <span class="st">" + "</span>))))</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">lm</span>(formula, <span class="at">data =</span> avgthesis)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">predictors =</span> predictor_set,</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> model,</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">AIC =</span> <span class="fu">AIC</span>(model))})</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert results to df</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>results_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(model_results, <span class="cf">function</span>(x) {</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">Predictors =</span> <span class="fu">paste</span>(x<span class="sc">$</span>predictors, <span class="at">collapse =</span> <span class="st">" + "</span>),</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">AIC =</span> x<span class="sc">$</span>AIC)}))</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the model with the lowest AIC</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>min_AIC <span class="ot">&lt;-</span> <span class="fu">min</span>(results_df<span class="sc">$</span>AIC)</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the delta AIC for each model</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>results_df <span class="ot">&lt;-</span> results_df <span class="sc">|&gt;</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Delta_AIC =</span> AIC <span class="sc">-</span> min_AIC) <span class="sc">|&gt;</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Delta_AIC)</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(results_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Predictors       AIC  Delta_AIC
1        TSS + CDOM -12.69800  0.0000000
2 TSS + CDOM + CHLa -12.24984  0.4481614
3       CDOM + CHLa  14.42785 27.1258567
4               TSS  16.37892 29.0769189
5              CDOM  16.94473 29.6427346
6        TSS + CHLa  18.05136 30.7493627
7              CHLa  25.03215 37.7301524
8                    25.43919 38.1371906</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>lm_tsscdom <span class="ot">&lt;-</span> <span class="fu">lm</span>(kd <span class="sc">~</span> TSS <span class="sc">+</span> CDOM, <span class="at">data =</span> avgthesis)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_tsscdom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = kd ~ TSS + CDOM, data = avgthesis)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.189702 -0.041730 -0.004259  0.023638  0.260876 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.35100    0.09457   3.712  0.00403 ** 
TSS          0.17402    0.01706  10.201 1.32e-06 ***
CDOM         0.17916    0.01799   9.960 1.65e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1245 on 10 degrees of freedom
Multiple R-squared:  0.9609,    Adjusted R-squared:  0.9531 
F-statistic: 122.8 on 2 and 10 DF,  p-value: 9.153e-08</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Effects of CHLa are still insignificant here, slopes are comparable to CDOM+TSS model</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>lm_allpred <span class="ot">&lt;-</span> <span class="fu">lm</span>(kd <span class="sc">~</span> TSS <span class="sc">+</span> CDOM <span class="sc">+</span> CHLa, <span class="at">data =</span> avgthesis)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_allpred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = kd ~ TSS + CDOM + CHLa, data = avgthesis)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.182594 -0.076012  0.003016  0.037342  0.238244 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.416306   0.112054   3.715  0.00481 ** 
TSS          0.189352   0.022206   8.527 1.32e-05 ***
CDOM         0.178032   0.017895   9.949 3.73e-06 ***
CHLa        -0.007777   0.007280  -1.068  0.31323    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1236 on 9 degrees of freedom
Multiple R-squared:  0.9653,    Adjusted R-squared:  0.9537 
F-statistic: 83.43 on 3 and 9 DF,  p-value: 6.897e-07</code></pre>
</div>
</div>
</section>
<section id="linear-mixed-effect-models" class="level1">
<h1>Linear Mixed Effect Models</h1>
<p>Here we want to use other variables as random effects to account for the nested design of the study: we have Dates within Sites within Lakes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MuMIn) </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>lmm1tss <span class="ot">&lt;-</span> <span class="fu">lmer</span>(kd <span class="sc">~</span> CDOM <span class="sc">+</span> CHLa <span class="sc">+</span> TSS <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Date), <span class="at">data =</span> allthesis)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmm1tss)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: kd ~ CDOM + CHLa + TSS + (1 | Date)
   Data: allthesis

REML criterion at convergence: 103.2

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.6528 -0.4259 -0.0190  0.4639  2.2400 

Random effects:
 Groups   Name        Variance Std.Dev.
 Date     (Intercept) 0.07915  0.2813  
 Residual             0.13398  0.3660  
Number of obs: 73, groups:  Date, 28

Fixed effects:
             Estimate Std. Error        df t value Pr(&gt;|t|)    
(Intercept)  0.455969   0.159210 45.872931   2.864 0.006290 ** 
CDOM         0.173599   0.025587 50.623584   6.785 1.23e-08 ***
CHLa         0.012678   0.008342 61.572973   1.520 0.133701    
TSS          0.113044   0.027897 53.745013   4.052 0.000164 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
     (Intr) CDOM   CHLa  
CDOM -0.466              
CHLa -0.391  0.106       
TSS  -0.227 -0.139 -0.652</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the fixed effect estimates</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>fixed_effects <span class="ot">&lt;-</span> <span class="fu">fixef</span>(lmm1tss)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the summary</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>summary_lmm1tss <span class="ot">&lt;-</span> <span class="fu">summary</span>(lmm1tss)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract p-values (if available)</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>p_values <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="st">"Pr(&gt;|t|)"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(summary_lmm1tss<span class="sc">$</span>coefficients)) {</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  summary_lmm1tss<span class="sc">$</span>coefficients[, <span class="st">"Pr(&gt;|t|)"</span>]</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NA</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract standard errors</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>se_values <span class="ot">&lt;-</span> summary_lmm1tss<span class="sc">$</span>coefficients[, <span class="st">"Std. Error"</span>]</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co"># R-squared</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>r_squared_values <span class="ot">&lt;-</span> <span class="fu">r.squaredGLMM</span>(lmm1tss)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Print full equation</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>equation <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"y = "</span>, <span class="fu">round</span>(fixed_effects[<span class="st">"(Intercept)"</span>], <span class="dv">4</span>))</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (name <span class="cf">in</span> <span class="fu">names</span>(fixed_effects)[<span class="sc">-</span><span class="dv">1</span>]) {</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  equation <span class="ot">&lt;-</span> <span class="fu">paste0</span>(equation, <span class="st">" + "</span>, <span class="fu">round</span>(fixed_effects[name], <span class="dv">4</span>), <span class="st">"*"</span>, name)</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Display</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">The relationship equation is:</span><span class="sc">\n</span><span class="st">"</span>, equation, <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
The relationship equation is:
 y = 0.456 + 0.1736*CDOM + 0.0127*CHLa + 0.113*TSS </code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (name <span class="cf">in</span> <span class="fu">names</span>(fixed_effects)[<span class="sc">-</span><span class="dv">1</span>]) {</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"Predictor: "</span>, name, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"  Coefficient: "</span>, <span class="fu">round</span>(fixed_effects[name], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"  P-value: "</span>, <span class="fu">round</span>(p_values[name], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"  Std. Error: "</span>, <span class="fu">round</span>(se_values[name], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Predictor: CDOM
  Coefficient:  0.1736 
  P-value:  0 
  Std. Error:  0.0256 

Predictor: CHLa
  Coefficient:  0.0127 
  P-value:  0.1337 
  Std. Error:  0.0083 

Predictor: TSS
  Coefficient:  0.113 
  P-value:  2e-04 
  Std. Error:  0.0279 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Marginal R-squared: "</span>, <span class="fu">round</span>(r_squared_values[<span class="dv">1</span>], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Marginal R-squared:  0.5929 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Conditional R-squared: "</span>, <span class="fu">round</span>(r_squared_values[<span class="dv">2</span>], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Conditional R-squared:  0.7441 </code></pre>
</div>
</div>
<p>Now we can also look at the residual plots for this model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(lmm1tss)</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co">#qqnorm(resid(lmm1tss))</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co">#qqline(resid(lmm1tss))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="changing-date-format" class="level1">
<h1>Changing Date Format</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Change format of Date to be Month/Year instead of Year/Month/Day</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This will allow us to account for "Date" as a random effect</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># This can't currently be done as reservoirs were sampled on different days in each month</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>allthesis <span class="ot">&lt;-</span> allthesis <span class="sc">%&gt;%</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">as.Date</span>(Date),          </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">Date =</span> <span class="fu">format</span>(Date, <span class="st">"%m/%Y"</span>))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using just Date as a random effect</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>lmmall <span class="ot">&lt;-</span> <span class="fu">lmer</span>(kd <span class="sc">~</span> CDOM <span class="sc">+</span> CHLa <span class="sc">+</span> TSS <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Date), <span class="at">data =</span> allthesis)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmmall)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: kd ~ CDOM + CHLa + TSS + (1 | Date)
   Data: allthesis

REML criterion at convergence: 107.7

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.9224 -0.4116  0.0212  0.5630  2.7193 

Random effects:
 Groups   Name        Variance Std.Dev.
 Date     (Intercept) 0.02786  0.1669  
 Residual             0.18114  0.4256  
Number of obs: 73, groups:  Date, 6

Fixed effects:
             Estimate Std. Error        df t value Pr(&gt;|t|)    
(Intercept)  0.453489   0.151140 35.758495   3.000  0.00489 ** 
CDOM         0.167531   0.021996 65.566875   7.616 1.33e-10 ***
CHLa         0.009699   0.007388 66.698150   1.313  0.19375    
TSS          0.127265   0.024280 67.010585   5.242 1.74e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
     (Intr) CDOM   CHLa  
CDOM -0.411              
CHLa -0.391  0.081       
TSS  -0.247 -0.103 -0.594</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#anova(lmm1tss)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using both Date and Lake as random effects</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>lmmall2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(kd <span class="sc">~</span> CDOM <span class="sc">+</span> CHLa <span class="sc">+</span> TSS <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Date<span class="sc">/</span>Lake), <span class="at">data =</span> allthesis)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmmall2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: kd ~ CDOM + CHLa + TSS + (1 | Date/Lake)
   Data: allthesis

REML criterion at convergence: 99.5

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.1590 -0.3452 -0.0108  0.3580  2.2699 

Random effects:
 Groups    Name        Variance Std.Dev.
 Lake:Date (Intercept) 0.13802  0.3715  
 Date      (Intercept) 0.04608  0.2147  
 Residual              0.08043  0.2836  
Number of obs: 73, groups:  Lake:Date, 40; Date, 6

Fixed effects:
             Estimate Std. Error        df t value Pr(&gt;|t|)    
(Intercept)  0.491629   0.184838 25.231448   2.660   0.0134 *  
CDOM         0.169006   0.025455 33.837533   6.639 1.32e-07 ***
CHLa         0.008713   0.007932 66.513967   1.098   0.2760    
TSS          0.122799   0.026674 62.222536   4.604 2.10e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
     (Intr) CDOM   CHLa  
CDOM -0.467              
CHLa -0.365  0.109       
TSS  -0.193 -0.115 -0.618</code></pre>
</div>
</div>
<p>Using average data instead of all data (Lake random effect)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>lmmavg1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(kd <span class="sc">~</span> CDOM <span class="sc">+</span> CHLa <span class="sc">+</span> TSS <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Lake), <span class="at">data =</span> avgthesis)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmmavg1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: kd ~ CDOM + CHLa + TSS + (1 | Lake)
   Data: avgthesis

REML criterion at convergence: -0.9

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-0.90516 -0.46684 -0.03639  0.34804  1.23325 

Random effects:
 Groups   Name        Variance Std.Dev.
 Lake     (Intercept) 0.032474 0.18020 
 Residual             0.002154 0.04641 
Number of obs: 13, groups:  Lake, 7

Fixed effects:
            Estimate Std. Error       df t value Pr(&gt;|t|)    
(Intercept) 0.384004   0.153968 7.378317   2.494 0.039672 *  
CDOM        0.184629   0.028223 4.511833   6.542 0.001834 ** 
CHLa        0.007120   0.005899 5.684350   1.207 0.275243    
TSS         0.137993   0.019494 6.881489   7.079 0.000214 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
     (Intr) CDOM   CHLa  
CDOM -0.557              
CHLa -0.408 -0.022       
TSS  -0.253 -0.091 -0.448</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(lmmall, lmmall2, lmmavg1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        df       AIC
lmmall   6 119.65644
lmmall2  7 113.51596
lmmavg1  6  11.05346</code></pre>
</div>
</div>
</section>
<section id="scaling-data-then-lmm" class="level1">
<h1>Scaling Data then LMM</h1>
<p>It is good practice to standardise your explanatory variables before proceeding so that they have a mean of zero (âcenteringâ) and standard deviation of one (âscalingâ). It ensures that the estimated coefficients are all on the same scale, making it easier to compare effect sizes.</p>
<p>scale() centers the data (the column mean is subtracted from the values in the column) and then scales it (the centered column values are divided by the columnâs standard deviation).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#hist(allthesis$kd)</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co">#hist(allthesis$TSS)</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co">#hist(allthesis$CHLa)</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co">#hist(allthesis$CDOM)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we scale our data, indicated by âpredictorâ1:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>allthesis<span class="sc">$</span>kd1 <span class="ot">&lt;-</span> <span class="fu">scale</span>(allthesis<span class="sc">$</span>kd, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co">#hist(allthesis$kd1)</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>allthesis<span class="sc">$</span>TSS1 <span class="ot">&lt;-</span> <span class="fu">scale</span>(allthesis<span class="sc">$</span>TSS, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co">#hist(allthesis$TSS1)</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>allthesis<span class="sc">$</span>CHLa1 <span class="ot">&lt;-</span> <span class="fu">scale</span>(allthesis<span class="sc">$</span>CHLa, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co">#hist(allthesis$CHLa1)</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>allthesis<span class="sc">$</span>CDOM1 <span class="ot">&lt;-</span> <span class="fu">scale</span>(allthesis<span class="sc">$</span>CDOM, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co">#hist(allthesis$CDOM1)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we try to normalize/standardize our predictors further by log transforming data first, then scaling, indicated by âpredictorâ2</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>allthesis<span class="sc">$</span>kd2 <span class="ot">&lt;-</span> <span class="fu">scale</span>(allthesis<span class="sc">$</span>kd, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co">#hist(allthesis$kd2)</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>allthesis<span class="sc">$</span>TSS2 <span class="ot">&lt;-</span> <span class="fu">scale</span>(<span class="fu">log</span>(allthesis<span class="sc">$</span>TSS), <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co">#hist(allthesis$TSS2)</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>allthesis<span class="sc">$</span>CHLa2 <span class="ot">&lt;-</span> <span class="fu">scale</span>(<span class="fu">log</span>(allthesis<span class="sc">$</span>CHLa), <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co">#hist(allthesis$CHLa2)</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>allthesis<span class="sc">$</span>CDOM2 <span class="ot">&lt;-</span> <span class="fu">scale</span>(<span class="fu">log</span>(allthesis<span class="sc">$</span>CDOM), <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co">#hist(allthesis$CDOM2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scaled Predictors, Date grouping</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>lmmall3 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(kd1 <span class="sc">~</span> CDOM1 <span class="sc">+</span> CHLa1 <span class="sc">+</span> TSS1 <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Date), <span class="at">data =</span> allthesis)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmmall3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: kd1 ~ CDOM1 + CHLa1 + TSS1 + (1 | Date)
   Data: allthesis

REML criterion at convergence: 150.9

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.9224 -0.4116  0.0212  0.5630  2.7193 

Random effects:
 Groups   Name        Variance Std.Dev.
 Date     (Intercept) 0.05851  0.2419  
 Residual             0.38043  0.6168  
Number of obs: 73, groups:  Date, 6

Fixed effects:
            Estimate Std. Error       df t value Pr(&gt;|t|)    
(Intercept)  0.03444    0.12296  5.10459   0.280    0.790    
CDOM1        0.54749    0.07188 65.56688   7.616 1.33e-10 ***
CHLa1        0.12633    0.09623 66.69815   1.313    0.194    
TSS1         0.48833    0.09317 67.01058   5.242 1.74e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
      (Intr) CDOM1  CHLa1 
CDOM1 -0.021              
CHLa1  0.056  0.081       
TSS1  -0.032 -0.103 -0.594</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scaled Predictors, Date and Lake grouping</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>lmmall4 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(kd1 <span class="sc">~</span> CDOM1 <span class="sc">+</span> CHLa1 <span class="sc">+</span> TSS1 <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Date<span class="sc">/</span>Lake), <span class="at">data =</span> allthesis)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmmall4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: kd1 ~ CDOM1 + CHLa1 + TSS1 + (1 | Date/Lake)
   Data: allthesis

REML criterion at convergence: 142.8

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.1590 -0.3452 -0.0108  0.3580  2.2699 

Random effects:
 Groups    Name        Variance Std.Dev.
 Lake:Date (Intercept) 0.28987  0.5384  
 Date      (Intercept) 0.09677  0.3111  
 Residual              0.16893  0.4110  
Number of obs: 73, groups:  Lake:Date, 40; Date, 6

Fixed effects:
            Estimate Std. Error       df t value Pr(&gt;|t|)    
(Intercept)  0.03966    0.16396  5.09963   0.242    0.818    
CDOM1        0.55231    0.08319 33.83753   6.639 1.32e-07 ***
CHLa1        0.11349    0.10332 66.51397   1.098    0.276    
TSS1         0.47119    0.10235 62.22254   4.604 2.10e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
      (Intr) CDOM1  CHLa1 
CDOM1 -0.127              
CHLa1 -0.012  0.109       
TSS1  -0.004 -0.115 -0.618</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Log transformed and scaled predictors, Date grouping</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>lmmall5 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(kd2 <span class="sc">~</span> CDOM2 <span class="sc">+</span> CHLa2 <span class="sc">+</span> TSS2 <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Date), <span class="at">data =</span> allthesis)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmmall5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: kd2 ~ CDOM2 + CHLa2 + TSS2 + (1 | Date)
   Data: allthesis

REML criterion at convergence: 165.6

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.8943 -0.5132 -0.0430  0.5096  3.3781 

Random effects:
 Groups   Name        Variance Std.Dev.
 Date     (Intercept) 0.04499  0.2121  
 Residual             0.47991  0.6928  
Number of obs: 73, groups:  Date, 6

Fixed effects:
            Estimate Std. Error       df t value Pr(&gt;|t|)    
(Intercept)  0.04044    0.11923  5.13375   0.339 0.747893    
CDOM2        0.47380    0.08464 68.06166   5.598 4.22e-07 ***
CHLa2        0.14567    0.09814 67.90831   1.484 0.142380    
TSS2         0.39065    0.10093 68.14840   3.871 0.000246 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
      (Intr) CDOM2  CHLa2 
CDOM2 -0.016              
CHLa2  0.052  0.113       
TSS2  -0.022 -0.307 -0.493</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Log transformed and scaled predictors, Date and Lake grouping</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>lmmall6 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(kd2 <span class="sc">~</span> CDOM2 <span class="sc">+</span> CHLa2 <span class="sc">+</span> TSS2 <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Date<span class="sc">/</span>Lake), <span class="at">data =</span> allthesis)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmmall6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: kd2 ~ CDOM2 + CHLa2 + TSS2 + (1 | Date/Lake)
   Data: allthesis

REML criterion at convergence: 151

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-2.53591 -0.26743  0.01217  0.28440  2.28477 

Random effects:
 Groups    Name        Variance Std.Dev.
 Lake:Date (Intercept) 0.44103  0.6641  
 Date      (Intercept) 0.07249  0.2692  
 Residual              0.16117  0.4015  
Number of obs: 73, groups:  Lake:Date, 40; Date, 6

Fixed effects:
            Estimate Std. Error       df t value Pr(&gt;|t|)    
(Intercept)  0.16268    0.16220  5.12716   1.003 0.360858    
CDOM2        0.46469    0.09854 39.56616   4.716 2.97e-05 ***
CHLa2        0.08396    0.10124 65.87486   0.829 0.409940    
TSS2         0.39471    0.10804 67.05168   3.653 0.000509 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
      (Intr) CDOM2  CHLa2 
CDOM2 -0.093              
CHLa2 -0.009  0.095       
TSS2   0.040 -0.310 -0.507</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(lmmall, lmmall2, lmmall3, lmmall4, lmmall5, lmmall6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Data: allthesis
Models:
lmmall: kd ~ CDOM + CHLa + TSS + (1 | Date)
lmmall3: kd1 ~ CDOM1 + CHLa1 + TSS1 + (1 | Date)
lmmall5: kd2 ~ CDOM2 + CHLa2 + TSS2 + (1 | Date)
lmmall2: kd ~ CDOM + CHLa + TSS + (1 | Date/Lake)
lmmall4: kd1 ~ CDOM1 + CHLa1 + TSS1 + (1 | Date/Lake)
lmmall6: kd2 ~ CDOM2 + CHLa2 + TSS2 + (1 | Date/Lake)
        npar     AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)    
lmmall     6  96.565 110.31 -42.283   84.565                         
lmmall3    6 150.736 164.48 -69.368  138.736  0.000  0               
lmmall5    6 165.931 179.67 -76.966  153.931  0.000  0               
lmmall2    7  91.533 107.57 -38.767   77.533 76.398  1  &lt; 2.2e-16 ***
lmmall4    7 145.704 161.74 -65.852  131.704  0.000  0               
lmmall6    7 154.434 170.47 -70.217  140.434  0.000  0               
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>So according to this anova, the best model would be lmmall2 or lmmall (both using data that hasnât been scaled) based on AIC values</p>
</section>
<section id="scaling-average-data" class="level1">
<h1>Scaling average data</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>avgthesis<span class="sc">$</span>kd1 <span class="ot">&lt;-</span> <span class="fu">scale</span>(avgthesis<span class="sc">$</span>kd, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co">#hist(allthesis$kd1)</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>avgthesis<span class="sc">$</span>TSS1 <span class="ot">&lt;-</span> <span class="fu">scale</span>(avgthesis<span class="sc">$</span>TSS, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="co">#hist(allthesis$TSS1)</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>avgthesis<span class="sc">$</span>CHLa1 <span class="ot">&lt;-</span> <span class="fu">scale</span>(avgthesis<span class="sc">$</span>CHLa, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co">#hist(allthesis$CHLa1)</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>avgthesis<span class="sc">$</span>CDOM1 <span class="ot">&lt;-</span> <span class="fu">scale</span>(avgthesis<span class="sc">$</span>CDOM, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="co">#hist(allthesis$CDOM1)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>avgthesis<span class="sc">$</span>kd2 <span class="ot">&lt;-</span> <span class="fu">scale</span>(avgthesis<span class="sc">$</span>kd, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co">#hist(allthesis$kd2)</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>avgthesis<span class="sc">$</span>TSS2 <span class="ot">&lt;-</span> <span class="fu">scale</span>(<span class="fu">log</span>(avgthesis<span class="sc">$</span>TSS), <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co">#hist(allthesis$TSS2)</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>avgthesis<span class="sc">$</span>CHLa2 <span class="ot">&lt;-</span> <span class="fu">scale</span>(<span class="fu">log</span>(avgthesis<span class="sc">$</span>CHLa), <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co">#hist(allthesis$CHLa2)</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>avgthesis<span class="sc">$</span>CDOM2 <span class="ot">&lt;-</span> <span class="fu">scale</span>(<span class="fu">log</span>(avgthesis<span class="sc">$</span>CDOM), <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="co">#hist(allthesis$CDOM2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>lmmavg2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(kd1 <span class="sc">~</span> CDOM1 <span class="sc">+</span> CHLa1 <span class="sc">+</span> TSS1 <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Lake), <span class="at">data =</span> avgthesis)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmmavg2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: kd1 ~ CDOM1 + CHLa1 + TSS1 + (1 | Lake)
   Data: avgthesis

REML criterion at convergence: 2.4

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-0.90516 -0.46684 -0.03639  0.34804  1.23325 

Random effects:
 Groups   Name        Variance Std.Dev.
 Lake     (Intercept) 0.098406 0.31370 
 Residual             0.006527 0.08079 
Number of obs: 13, groups:  Lake, 7

Fixed effects:
             Estimate Std. Error        df t value Pr(&gt;|t|)    
(Intercept) 0.0009964  0.1251690 4.2300465   0.008 0.994010    
CDOM1       0.6516669  0.0996148 4.5118328   6.542 0.001834 ** 
CHLa1       0.0797917  0.0661068 5.6843505   1.207 0.275243    
TSS1        0.5135994  0.0725564 6.8814895   7.079 0.000214 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
      (Intr) CDOM1  CHLa1 
CDOM1 -0.235              
CHLa1 -0.050 -0.022       
TSS1   0.009 -0.091 -0.448</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>lmmavg3 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(kd2 <span class="sc">~</span> CDOM2 <span class="sc">+</span> CHLa2 <span class="sc">+</span> TSS2 <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Lake), <span class="at">data =</span> avgthesis)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmmavg3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: kd2 ~ CDOM2 + CHLa2 + TSS2 + (1 | Lake)
   Data: avgthesis

REML criterion at convergence: 7.2

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-0.85647 -0.53768 -0.02399  0.16313  1.18365 

Random effects:
 Groups   Name        Variance Std.Dev.
 Lake     (Intercept) 0.234007 0.4837  
 Residual             0.007552 0.0869  
Number of obs: 13, groups:  Lake, 7

Fixed effects:
            Estimate Std. Error      df t value Pr(&gt;|t|)   
(Intercept)  0.17543    0.18644 5.00354   0.941  0.38991   
CDOM2        0.54133    0.14887 5.99563   3.636  0.01090 * 
CHLa2        0.01332    0.06986 5.47369   0.191  0.85567   
TSS2         0.44847    0.07896 5.45133   5.679  0.00177 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
      (Intr) CDOM2  CHLa2 
CDOM2 -0.119              
CHLa2 -0.019 -0.191       
TSS2   0.047 -0.241 -0.281</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(lmmavg1, lmmavg2, lmmavg3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Data: avgthesis
Models:
lmmavg1: kd ~ CDOM + CHLa + TSS + (1 | Lake)
lmmavg2: kd1 ~ CDOM1 + CHLa1 + TSS1 + (1 | Lake)
lmmavg3: kd2 ~ CDOM2 + CHLa2 + TSS2 + (1 | Lake)
        npar      AIC     BIC  logLik deviance Chisq Df Pr(&gt;Chisq)
lmmavg1    6 -13.2702 -9.8805 12.6351  -25.270                    
lmmavg2    6   1.1424  4.5321  5.4288  -10.858     0  0           
lmmavg3    6   7.9690 11.3587  2.0155   -4.031     0  0           </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(lm_tsscdom, lmmavg1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           df       AIC
lm_tsscdom  4 -12.69800
lmmavg1     6  11.05346</code></pre>
</div>
</div>
<p>Best model for avg data is âlm_tsscdomâ</p>
<p>It appears as though for both average data and all data models, the best models are those that do not have scaled data or log data. lmmall2 uses both lake and date as random effects, while lm_tsscdom is just a simple multivariate linear regression (no random effects)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(lm_tsscdom, lmmall2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           df     AIC
lm_tsscdom  4 -12.698
lmmall2     7 113.516</code></pre>
</div>
</div>
<p>Between those two models, it appears that the simple multivariate regression is the best.</p>
</section>
<section id="comparison-of-multivariate-predictor-contributions-vs-univariate-residual-method" class="level1">
<h1>Comparison of multivariate predictor contributions vs univariate residual method</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(lm_tsscdom)</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co">#TSS slope = 0.17402</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co">#CDOM slope = 0.17916</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>PercentContributions <span class="ot">&lt;-</span> avgthesis <span class="sc">|&gt;</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">%TSS</span><span class="st">`</span> <span class="ot">=</span> ((TSS<span class="sc">*</span><span class="fl">0.20337</span>)<span class="sc">/</span>kd)<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">%CDOM</span><span class="st">`</span> <span class="ot">=</span> ((CDOM<span class="sc">*</span><span class="fl">0.17382</span>)<span class="sc">/</span>kd)<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">mult%TSS</span><span class="st">`</span> <span class="ot">=</span> ((TSS<span class="sc">*</span><span class="fl">0.17402</span>)<span class="sc">/</span>kd)<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">mult%CDOM</span><span class="st">`</span> <span class="ot">=</span> ((CDOM<span class="sc">*</span><span class="fl">0.17916</span>)<span class="sc">/</span>kd)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="st">`</span><span class="at">Site</span><span class="st">`</span>, <span class="st">`</span><span class="at">%TSS</span><span class="st">`</span>, <span class="st">`</span><span class="at">%CDOM</span><span class="st">`</span>, <span class="st">`</span><span class="at">mult%TSS</span><span class="st">`</span>, <span class="st">`</span><span class="at">mult%CDOM</span><span class="st">`</span>)</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(PercentContributions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 Ã 5
  Site        `%TSS` `%CDOM` `mult%TSS` `mult%CDOM`
  &lt;chr&gt;        &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;
1 2-BRI010.78   51.0    27.5       43.6        28.4
2 2-BRI013.12   54.6    25.5       46.7        26.3
3 2-DYC000.19   56.0    21.9       47.9        22.6
4 2-MBN000.96   55.3    27.3       47.3        28.1
5 2-SDY004.27   61.6    28.9       52.7        29.7
6 2-SDY005.85   67.7    25.6       57.9        26.4</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Paired t-test for %TSS vs mult%TSS</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>t_test_tss <span class="ot">&lt;-</span> <span class="fu">t.test</span>(PercentContributions<span class="sc">$</span><span class="st">`</span><span class="at">%TSS</span><span class="st">`</span>, PercentContributions<span class="sc">$</span><span class="st">`</span><span class="at">mult%TSS</span><span class="st">`</span>, <span class="at">paired =</span> <span class="cn">TRUE</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Paired t-test for %CDOM vs mult%CDOM</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>t_test_cdom <span class="ot">&lt;-</span> <span class="fu">t.test</span>(PercentContributions<span class="sc">$</span><span class="st">`</span><span class="at">%CDOM</span><span class="st">`</span>, PercentContributions<span class="sc">$</span><span class="st">`</span><span class="at">mult%CDOM</span><span class="st">`</span>, <span class="at">paired =</span> <span class="cn">TRUE</span>)</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>t_test_tss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Paired t-test

data:  PercentContributions$`%TSS` and PercentContributions$`mult%TSS`
t = 17.187, df = 12, p-value = 8.119e-10
alternative hypothesis: true mean difference is not equal to 0
95 percent confidence interval:
 7.232660 9.332607
sample estimates:
mean difference 
       8.282634 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>t_test_cdom</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Paired t-test

data:  PercentContributions$`%CDOM` and PercentContributions$`mult%CDOM`
t = -8.349, df = 12, p-value = 2.422e-06
alternative hypothesis: true mean difference is not equal to 0
95 percent confidence interval:
 -1.0561759 -0.6190079
sample estimates:
mean difference 
     -0.8375919 </code></pre>
</div>
</div>
<p>According to the results of the paired Ttests there are statistical differences in our percent kd explained by predictors based on univariate vs multivariate results.</p>
<p>Doing univariate regressions and subtracting out the residuals gives us estimates of TSS effects that is ~8% higher than multivariate estimates on average.</p>
<p>Alternatively, univariate estimates of CDOM effects are ~0.84% lower than multivariate estimates on average.</p>
<p>Comparing percent contributions between multivariate and univariate (hierarchical) regressions is tricky as to do so, we have to be sure that our predictors are not correlated. Multivariate regressions are order independent and partition variance simultaneously.</p>
</section>
<section id="does-order-matter" class="level1">
<h1>Does order matter?</h1>
<p>I know that changing the order in which I do my univariate regressions changes the percent estimates for each predictor. Theoretically, I donât think this should be the case since TSS and CDOM should not be correlated, one represents scattering effects and one represents absorption effects.</p>
<p>Here I want to run a quick test to determine if there actually is a correlation between TSS and CDOM that may be causing the order of our regressions to change our findings.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(avgthesis[, <span class="fu">c</span>(<span class="st">"TSS"</span>, <span class="st">"CDOM"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           TSS      CDOM
TSS  1.0000000 0.1727488
CDOM 0.1727488 1.0000000</code></pre>
</div>
</div>
<p>Here, it appears as though CDOM and TSS are minorly correlated indicating that there may be some shared variance between predictors. While this isnât a lot, it is likely enough to make the sequential univariate regressions order sensitive. Due to these being slightly correlated, it may be better to use a multivariate approach.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(<span class="fu">lm</span>(kd <span class="sc">~</span> TSS <span class="sc">+</span> CDOM, <span class="at">data =</span> avgthesis))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    TSS    CDOM 
1.03076 1.03076 </code></pre>
</div>
</div>
<p>A VIF of 1 indicates no correlation between predictors, this value (1.03) means there is negligible correlation and that the slopes of this multivariate regression can be treated as independent contributions to kd.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>